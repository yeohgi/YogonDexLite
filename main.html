<html>

    <head>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
        <script>

            format = "";
            elo = -1;
            shiny = false;
            showing = ""

            //FORMAT
            function setFormat(){

                format = $('#getformat').val()
                console.log(format)

                checkFormat(function(valid){

                    if(valid){
                        showElo()
                    }else{
                        console.log("no no no, bad format")
                    }

                });
            }

            function checkFormat(callback) {

                var url = format + ".format";

                $.get(url, function(data) {
                    validFormatString = data;

                    if(validFormatString === "True"){
                        validFormat = true
                    }else{
                        validFormat = false
                    }

                    callback(validFormat);
                });
            }

            //ELO
            function setElo(){
                elo = $('#getelo').val()
                console.log(elo)

                if(elo >= 1000){
                    showMain()
                }else{
                    console.log("no no no, bad elo")
                }
                
            }

            function showElo(){
                $('#getformatbody').css('display', 'none');
                $('#getelobody').css('display', 'block');
                $('#mainbody').css('display', 'none');
                $('#getformatbody').remove();
            }

            //MAIN
            function showMain(){
                $('#getformatbody').css('display', 'none');
                $('#getelobody').css('display', 'none');
                $('#mainbody').css('display', 'block');
                $('#getelobody').remove();
            }

            function searchPokemon(){

                pokemon = $('#searchpokemonfield').val()
                console.log(pokemon)

                getPokemonInfo(function(info){
                    console.log(info)
                    
                    //0
                    if(info[0] > -1){
                        //handle in format case

                        //1 - update name
                        $('#pokemonname').text(info[1]);

                        //2 - update dex number
                        $('#pokemondexnumber').text(info[2]);

                        //3 - update rank
                        if(info[0] == 0){
                            $('#pokemonrank').text(info[3]);
                        }else{
                            $('#pokemonrank').text("N/A");
                        }
                        
                        //4 - update usage
                        if(info[0] == 0){
                            $('#pokemonusage').text(info[4]);
                        }else{
                            $('#pokemonusage').text("N/A");
                        }

                        //5 - update type
                        $("#pokemontype1image").attr("src", "https://play.pokemonshowdown.com/sprites/types/" + info[5][0] + ".png");
                        if(info[5][1].length > 1){
                            $("#pokemontype2image").attr("src", "https://play.pokemonshowdown.com/sprites/types/" + info[5][1] + ".png");
                        }else{
                            $("#pokemontype2image").attr("src", "https://play.pokemonshowdown.com/sprites/types/%3f%3f%3f.png");
                        }

                        //6 - defensive matchups
                        defRowIds = ['#pokemon0xmu', '#pokemon4xmu', '#pokemon2xmu', '#pokemon1xmu', '#pokemon1d2xmu', '#pokemon1d4xmu']
                        defRowMUs = ['0x: ', '4x: ', '2x: ', '1x: ', '1/2x: ', '1/4x: ']
                        for(var i = 0; i < 6; i++){
                            $(defRowIds[i]).empty();
                            if(info[6][i].length > 0){
                                rowData = '<td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">' + defRowMUs[i] + '</p></td>'
                                $(defRowIds[i]).append(rowData);
                            }
                            for(var j = 0; j < info[6][i].length; j++){
                                imageData = '<td><img id="pokemontype2image" style="display:inline; vertical-align:middle;" src="https://play.pokemonshowdown.com/sprites/types/' + info[6][i][j] + '.png" alt="???"></td>'
                                $(defRowIds[i]).append(imageData)
                            }
                        }


                        //7 - update ablities
                        ablIds = ['#pokemonabl1', '#pokemonabl2', '#pokemonablhidden']
                        if(info[0] == 0){

                            for(var i = 0; i < 3; i++){

                                if(info[7].length < i + 1){
                                    $(ablIds[i]).text("");
                                    $(ablIds[i]).attr("title", "");
                                }else if(info[7][i].length == 3){
                                    $(ablIds[i]).text(info[7][i][1]);
                                    $(ablIds[i]).attr("title", info[7][i][2]);
                                }else{
                                    $(ablIds[i]).text("");
                                    $(ablIds[i]).attr("title", "");
                                }
                            }

                        }else if(info[0] == 1){
                            for(var i = 0; i < 3; i++){

                                if(info[7].length < i + 1){
                                    $(ablIds[i]).text("");
                                }else if(info[7][i].length == 2){
                                    $(ablIds[i]).text(info[7][i][0]);
                                }else{
                                    $(ablIds[i]).text("");
                                }
                            }
                        }
                        
                        //8 - update stats
                        stats = ['#pokemonhp', '#pokemonatk', '#pokemondef', '#pokemonspatk', '#pokemonspdef', '#pokemonspd']
                        bars = ['#hpbar', '#atkbar', '#defbar', '#spatkbar', '#spdefbar', '#spdbar']
                        for(var i = 0; i < 6; i++){
                            $(stats[i]).text(info[8][i]);
                            $(bars[i]).css("width", barLength(info[8][i]) + "px");
                            colors = barColor(info[8][i])
                            console.log(colors)
                            $(bars[i]).css("background-color", colors[0]);
                            $(bars[i]).css("border", "2px solid "+ colors[1]);
                        }

                        //9 - update spreads
                        $('#pokemonspreadstable').empty();
                        newRow = '<tr><td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Spreads: </p></td></tr>'
                        $('#pokemonspreadstable').append(newRow);
                        for(var i = 0; i < info[9].length; i++){
                            if(info[9][i].length > 2){
                                newRow = '<tr><td><p style="display:inline; vertical-align:middle; font-size: 12;">'+ info[9][i][2] + '% ' + info[9][i][1] + ' ' + info[9][i][0] + '</p></td></tr>'
                                $('#pokemonspreadstable').append(newRow);
                            }else{
                                newRow = '<tr><td><p style="display:inline; vertical-align:middle; font-size: 12;">'+ info[9][i][1] + '% ' + info[9][i][0] + '</p></td></tr>'
                                $('#pokemonspreadstable').append(newRow);
                            }
                        }

                        //10 - update moves
                        $('#pokemonmovestable').empty();
                        newRow = '<tr><td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Moves: </p></td></tr>'
                        $('#pokemonmovestable').append(newRow);
                        for(var i = 0; i < info[10].length; i++){
                            console.log(info[10][i])
                            newRow = '<tr><td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">' + info[10][i][0] + ' ' + info[10][i][1] + '</p></td><td><img id="pokemontype2image" style="display:inline; vertical-align:middle;" src="https://play.pokemonshowdown.com/sprites/types/' + info[10][i][2] + '.png" alt="???"></td><td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">' + info[10][i][3] + '</p></td><td><img id="pokemontype2image" style="display:inline; vertical-align:middle;" src="https://play.pokemonshowdown.com/sprites/categories/' + info[10][i][4] + '.png" alt="???"></td></tr>'
                            $('#pokemonmovestable').append(newRow);
                        }
                        
                        //11 - update items
                        $('#pokemonitemstable').empty();
                        newRow = '<tr><td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Items: </p></td></tr>'
                        $('#pokemonitemstable').append(newRow);
                        for(var i = 0; i < info[11].length; i++){
                            newRow = '<tr><td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">' + info[11][i][0] + ' ' + info[11][i][1] + '</p></td></tr>'
                            $('#pokemonitemstable').append(newRow);
                        }

                        //12 - update teammates
                        $('#pokemonteammatestable').empty();
                        newRow = '<tr><td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Teammates: </p></td></tr>'
                        $('#pokemonteammatestable').append(newRow);
                        for(var i = 0; i < info[12].length; i++){
                            newRow = '<tr><td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">' + info[12][i][0] + ' ' + info[12][i][1] + '</p></td></tr>'
                            $('#pokemonteammatestable').append(newRow);
                        }

                        //13 - update image
                        showing = info[13]
                        updatePokemonSprite()
                        
                        //update
                    }else{
                        //must be -1, return error/invalid
                    }
                }, pokemon);
            }

            function getPokemonInfo(callback, pokemon) {

                var url = pokemon + ".pokemon";
                var params = {format: format, elo:elo};

                console.log(params)

                $.get(url, params, function(data) {
                    callback(data);
                });
            }

            function updatePokemonSprite(){
                if(shiny){
                    $("#pokemonImage").attr("src", "https://play.pokemonshowdown.com/sprites/gen5-shiny/" + showing + ".png")
                }else{
                    $("#pokemonImage").attr("src", "https://play.pokemonshowdown.com/sprites/gen5/" + showing + ".png")
                }
                
            }

            function toggleShiny(){
                if(shiny){
                    shiny = false;
                }else{
                    shiny = true;
                }
                updatePokemonSprite()
            }

            function barColor(stat){

                colorCodes = ["#bd0404", "#d17600", "#d1b900", "#80eb34", "#009e08", "#009e9b"]
                colorCodesBorder = ["#a80202", "#b56600", "#bda702", "#49ab03", "#017507", "#018582"]

                if(stat >= 150){
                    return [colorCodes[5], colorCodesBorder[5]];
                }else if(stat >= 120){
                    return [colorCodes[4], colorCodesBorder[4]];
                }else if(stat >= 90){
                    return [colorCodes[3], colorCodesBorder[3]];
                }else if(stat >= 60){
                    return [colorCodes[2], colorCodesBorder[2]];
                }else if(stat >= 30){
                    return [colorCodes[1], colorCodesBorder[1]];
                }else{
                    return [colorCodes[0], colorCodesBorder[0]];
                }
            }

            function barLength(stat){
                return stat * 1.4;
            }

        </script>

        <style>
            
            body{
            margin: 0;
            margin-bottom: 100vh;
            padding: 0;
            text-align: center;
            /* background-image: url("background.png");
            background-repeat: no-repeat;
            background-size: 100%;
            background-color:rgb(24, 18, 8); */
            }

            #getelobody{
                display: none;
            }
            #mainbody {
                display: none;
            }

            .tooltip {
                position: relative; /* Make sure the tooltip is positioned relative */
            }

            .tooltip::after {
                content: attr(title); /* Set the content of the tooltip */
                display: none; /* Hide the tooltip by default */
                position: absolute; /* Position the tooltip absolutely */
                top: 100%; /* Position the tooltip below the element */
                left: 50%; /* Align the tooltip with the center of the element */
                transform: translateX(-50%); /* Center the tooltip horizontally */
                background-color: rgba(0, 0, 0, 0.9); /* Tooltip background color */
                color: #fff; /* Tooltip text color */
                padding: 5px; /* Add padding to the tooltip */
                border-radius: 5px; /* Add border radius to the tooltip */
                white-space: nowrap; /* Prevent line breaks in the tooltip */
                z-index: 1; /* Ensure the tooltip appears above other elements */
            }

            .tooltip:hover::after {
                display: block; /* Show the tooltip when hovering over the element */
            }

            .rectangle {
                width: 200px; /* Width of the rectangle */
                height: 10px; /* Height of the rectangle */
                background-color: #3498db; /* Background color of the rectangle */
                border: 2px solid #2980b9; /* Border style of the rectangle */
                border-radius: 5px; /* Border radius to give rounded corners (optional) */
            }

        </style>

    </head>

    <body>
        <!-- get format -->
        <div id="getformatbody">
            <input id="getformat" name="getformat" value="gen9doublesou" />
            <button style="display:inline; vertical-align:middle; font-size: 12;" onmousedown="setFormat();" id="setFormatButton">Set Format</button>
        </div>

        <!-- get elo -->
        <div id="getelobody">
            <input id="getelo" name="getelo" value="1000" />
            <button style="display:inline; vertical-align:middle; font-size: 12;" onmousedown="setElo();" id="setEloButton">Set Elo</button>
        </div>

        <!-- mainpage -->
        <div id="mainbody">

            <h2>YogonDexLite</h2>

            <img id="pokemonImage" src="https://play.pokemonshowdown.com/sprites/substitutes/gen5/substitute.png" alt="INPUT A POKEMON TO SEE IT!!!">

            <!-- huge table -->
            <table style="margin-left:auto; margin-right:auto; vertical-align:middle;">

                <!-- name -->
                <!-- dex number -->
                <!-- rank -->
                <!-- usage -->
                <tr id="pokemonnamerow">

                    <table id="pokemonnametable" style="margin-left:auto; margin-right:auto; vertical-align:middle;">
                        <tr>
                            <td id="pokemonnames"><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Name: </p>            <p style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonname">A Pokemon</p></td>
                            <td id="pokemondexnumbers"><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Dex Number: </p> <p style="display:inline; vertical-align:middle; font-size: 12;" id="pokemondexnumber">A Number</p></td>
                            <td id="pokemonranks"><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Rank: </p>            <p style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonrank">A Rank</p></td>
                            <td id="pokemonusages"><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Usage: </p>          <p style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonusage">A Usage</p></td>
                        </tr>
                    </table>

                </tr>

                <!-- type -->
                <tr id="pokemontypesrow">

                    <table id="pokemontypestable" style="margin-left:auto; margin-right:auto; vertical-align:middle;">

                        <tr>
                            <td><img id="pokemontype1image" style="display:inline; vertical-align:middle;" src="https://play.pokemonshowdown.com/sprites/types/%3f%3f%3f.png" alt="???"></td>
                            <td><img id="pokemontype2image" style="display:inline; vertical-align:middle;" src="https://play.pokemonshowdown.com/sprites/types/%3f%3f%3f.png" alt="???"></td>
                        </tr>

                    </table>

                </tr>

                <!-- abl -->
                <tr id="pokemonabilitiesrow">

                    <table id="pokemonabilitiestable" style="margin-left:auto; margin-right:auto; vertical-align:middle;">

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;" id="pokemonabls">Abilities: </p></td>
                            <td><p class="tooltip" style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonabl1" title="DESCRIPTION 1">Abl 1</p></td>
                            <td><p class="tooltip" style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonabl2" title="DESCRIPTION 2">Abl 2</p></td>
                            <td><p class="tooltip" style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonablhidden" title="DESCRIPTION HIDDEN">Abl Hidden</p></td>
                        </tr>
        
                    </table>

                </tr>

                <!-- def matchups -->
                <tr id="pokemondefmatchupsrow">

                    <table id="pokemondefmatchupstable" style="margin-left:auto; margin-right:auto; vertical-align:middle;">
                        <tr id="pokemon0xmu">
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">0x: </p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;">0x</p></td>
                        </tr>

                        <tr id="pokemon4xmu">
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">4x: </p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;">4x</p></td>
                        </tr>

                        <tr id="pokemon2xmu">
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">2x :</p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;">2x</p></td>
                        </tr>

                        <tr id="pokemon1xmu">
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">1x: </p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;">1x</p></td>
                        </tr>

                        <tr id="pokemon1d2xmu">
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">1/2x: </p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;">1/2x</p></td>
                        </tr>

                        <tr id="pokemon1d4xmu">
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">1/4x: </p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;">1/4x</p></td>
                        </tr>

                    </table>

                </tr>

                <!-- stats -->
                <tr id="pokemonstatsrow">      

                    <table id="pokemonstatstable" style="margin-left:auto; margin-right:auto; vertical-align:middle;">

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;" id="hplabel">HP:</p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonhp">HP</p></td>
                            <td><div id="hpbar" style="background-color: #c5c5c5; border: 2px solid #a4a4a4;" class="rectangle"></div></td>
                        </tr>

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;" id="atklabel">ATK:</p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonatk">ATK</p></td>
                            <td><div id="atkbar" style="background-color: #c5c5c5; border: 2px solid #a4a4a4;" class="rectangle"></div></td>
                        </tr>

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;" id="deflabel">DEF:</p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;" id="pokemondef">DEF</p></td>
                            <td><div id="defbar" style="background-color: #c5c5c5; border: 2px solid #a4a4a4;" class="rectangle"></div></td>
                        </tr>

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;" id="spatklabel">SPATK:</p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonspatk">SPATK</p></td>
                            <td><div id="spatkbar" style="background-color: #c5c5c5; border: 2px solid #a4a4a4;" class="rectangle"></div></td>
                        </tr>

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;" id="spdeflabel">SPDEF:</p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonspdef">SPDEF</p></td>
                            <td><div id="spdefbar" style="background-color: #c5c5c5; border: 2px solid #a4a4a4;" class="rectangle"></div></td>
                        </tr>

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;" id="spdlabel">SPD:</p></td>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12;" id="pokemonspd">SPD</p></td>
                            <td><div id="spdbar" style="background-color: #c5c5c5; border: 2px solid #a4a4a4;" class="rectangle"></div></td>
                        </tr>

                    </table>

                </tr>

                <!-- spreads -->
                <tr id="pokemonspreadsrow">

                    <table id="pokemonspreadstable" style="margin-left:auto; margin-right:auto; vertical-align:middle;">

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Spreads: </p></td>
                        </tr>
                    
                    </table>
                </tr>

                <!-- moves -->
                <tr id="pokemonmovesrow">

                    <table id="pokemonmovestable" style="margin-left:auto; margin-right:auto; vertical-align:middle;">

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Moves: </p></td>
                        </tr>
                    
                    </table>
                </tr>

                <!-- items -->
                <tr id="pokemonitemsrow">

                    <table id="pokemonitemstable" style="margin-left:auto; margin-right:auto; vertical-align:middle;">

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Items: </p></td>
                        </tr>
                    
                    </table>
                </tr>

                <!-- teammates -->
                <tr id="pokemonteammatesrow">

                    <table id="pokemonteammatestable" style="margin-left:auto; margin-right:auto; vertical-align:middle;">

                        <tr>
                            <td><p style="display:inline; vertical-align:middle; font-size: 12; font-weight: bold;">Teammates: </p></td>
                        </tr>
                    
                    </table>
                </tr>

                <!-- search -->
                <tr id="pokemonsearchrow">

                    <td><input id="searchpokemonfield" name="searchpokemonfield" value="raging bolt"/>
                    <button style="display:inline; vertical-align:middle; font-size: 12;" onmousedown="searchPokemon();" id="searchPokemonButton">Search Pokemon</button></td>

                </tr>

                <!-- shiny -->
                <tr id="pokemonshiny">

                    <td><button style="display:inline; vertical-align:middle; font-size: 12;" onmousedown="toggleShiny();" id="toggleShinyButton">Toggle Shiny</button></td>

                </tr>

            </table>
        </div>

    </body>

    
</html>